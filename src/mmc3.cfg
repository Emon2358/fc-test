# ===============================================
# MMC3 Mapper (Mapper 004) 用 ld65 設定ファイル
# 対応: ファミコン実機 / GitHub Actions ビルド両対応
# ===============================================

MEMORY {
    # ゼロページ
    ZP:       start = $0000, size = $0100, type = rw, define = yes;

    # 通常RAM
    RAM:      start = $0200, size = $0600, type = rw, define = yes;

    # セーブRAM（SRAM）: 0x6000-0x7FFF
    SRAM:     start = $6000, size = $2000, type = rw, define = yes, file = "";

    # PRG-ROM（プログラム領域）: 32KB (0x8000〜0xFFFF)
    PRG:      start = $8000, size = $8000, type = ro, define = yes, file = %O;

    # iNESヘッダ
    HEADER:   start = $0000, size = $0010, file = %O, fill = yes;

    # CHR-ROM (パターンテーブル)
    CHR:         start = $0000, size = $20000, file = %O, fill = yes;

    # Pythonスクリプトの出力するVIDEO_CHR領域 (CHRと同義)
    VIDEO_CHR:   start = $0000, size = $20000, file = %O, fill = yes;

    # マップデータ領域 (SRAM上にマップを想定)
    VIDEO_MAP:   start = $6000, size = $2000, type = rw, define = yes;
}

SEGMENTS {
    ZEROPAGE:   load = ZP,   type = zp;
    BSS:        load = RAM,  type = bss, define = yes;
    DATA:       load = PRG,  run = RAM, type = rw;
    RODATA:     load = PRG,  type = ro;
    CODE:       load = PRG,  type = ro, start = $8000;
    VECTORS:    load = PRG,  type = ro, start = $FFFA;
    HEADER:     load = HEADER, type = ro;
    CHARS:      load = CHR, type = ro, optional = yes;
    VIDEO_CHR:  load = VIDEO_CHR, type = ro, optional = yes;
    VIDEO_MAP:  load = VIDEO_MAP, type = rw, optional = yes;
}

FEATURES {
    CONDES: segment = RODATA,
            type = constructor,
            label = __CONSTRUCTOR_TABLE__,
            count = __CONSTRUCTOR_COUNT__;
}
