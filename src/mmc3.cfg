# ===============================================
# MMC3 Mapper (Mapper 004) 用 ld65 設定ファイル
# 対応: ファミコン実機 / GitHub Actions ビルド
# ===============================================

MEMORY {
    ZP:       start = $0000, size = $0100, type = rw, define = yes;
    RAM:      start = $0200, size = $0600, type = rw, define = yes;

    # セーブRAM（SRAM）
    SRAM:     start = $6000, size = $2100, type = rw, define = yes;

    # PRG-ROM (32KB)
    PRG:      start = $8000, size = $8000, type = ro, file = %O, fill = yes;

    # iNESヘッダ (16 bytes)
    HEADER:   start = $0000, size = $0010, file = %O, fill = yes;

    # CHR-ROM (128KB)
    CHR:      start = $0000, size = $20000, file = %O, fill = yes;

    # VIDEO_CHR (同容量)
    VIDEO_CHR: start = $0000, size = $20000, file = %O, fill = yes;

    # 差分MAPデータ
    VIDEO_MAP: start = $6000, size = $2100, type = rw, define = yes;
}

SEGMENTS {
    HEADER:     load = HEADER, type = ro;
    ZEROPAGE:   load = ZP,     type = zp;
    BSS:        load = RAM,    type = bss;
    CODE:       load = PRG,    type = ro, start = $8000;
    RODATA:     load = PRG,    type = ro;
    VIDEO_MAP:  load = VIDEO_MAP, type = rw, optional = yes;
    VIDEO_CHR:  load = VIDEO_CHR, type = ro, optional = yes;
    CHR:        load = CHR, type = ro, optional = yes;
    VECTORS:    load = PRG, type = ro, start = $FFFA;
}

FEATURES {
    CONDES: segment = RODATA,
            type = constructor,
            label = __CONSTRUCTOR_TABLE__,
            count = __CONSTRUCTOR_COUNT__;
}
